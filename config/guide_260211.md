ì»¤ì„œ(Cursor)ì˜ **Composer(Ctrl+I)** ë˜ëŠ” **Chat(Ctrl+L)** ê¸°ëŠ¥ì„ í™œìš©í•´ ì¦‰ì‹œ ì‹œìŠ¤í…œì„ ê°œí¸í•  ìˆ˜ ìˆë„ë¡, ê¸°ì¡´ í”„ë¡¬í”„íŠ¸ë¥¼ ìˆ˜ì •í•˜ê³  êµ¬ì²´ì ì¸ ì‹¤í–‰ ê°€ì´ë“œë¥¼ ì •ë¦¬í•´ ë“œë¦½ë‹ˆë‹¤.

ì•„ë˜ ë‚´ìš©ì„ ì»¤ì„œì— ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ìœ¼ì‹œë©´ ë©ë‹ˆë‹¤.

---

## ## 1. `prompts.py` ìˆ˜ì • (í”„ë¡¬í”„íŠ¸ í†µí•© ë° êµ¬ì¡°í™”)

ë¨¼ì € `prompts.py` íŒŒì¼ ë‚´ì˜ í•¨ìˆ˜ë“¤ì„ **Single-pass**ìš©ìœ¼ë¡œ êµì²´í•˜ê±°ë‚˜ ì¶”ê°€í•˜ë„ë¡ ì§€ì‹œí•˜ì„¸ìš”.

> **Cursor ì§€ì‹œë¬¸:** > "ê¸°ì¡´ì˜ `get_system_prompt`, `get_key_takeaways_prompt`, `get_section_body_prompt`ë¥¼ ì•„ë˜ì˜ í†µí•©ëœ **Single-pass** í”„ë¡¬í”„íŠ¸ í•¨ìˆ˜ë“¤ë¡œ êµì²´í•˜ê±°ë‚˜ ì¶”ê°€í•´ì¤˜. JSON íŒŒì‹± ì—ëŸ¬ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ì´ìŠ¤ì¼€ì´í”„ ë¬¸ì(`\n`) ì²˜ë¦¬ë¥¼ ê°•ì¡°í•˜ë„ë¡ ìˆ˜ì •í–ˆì–´."

```python
def get_combined_key_takeaways_prompt() -> str:
    """
    í•œê¸€/ì˜ì–´ í†µí•© íƒ€ì´í‹€ ë° ì£¼ìš” ìš”ì•½ ìƒì„±ìš© í”„ë¡¬í”„íŠ¸
    """
    return """
# Task
Analyze the provided news topics and generate Executive Summaries and Titles for BOTH Korean and English in a SINGLE JSON response.

# Requirements
1. Korean (ko): Professional Analyst style. Title (30-50 chars, specific with numbers/companies), Summary (3-5 points, concise noun phrases).
2. English (en): Goldman Sachs/Bloomberg style. Title (40-70 chars, Subject+Verb+Object), Summary (3-5 points, concise professional sentences).

# Output Format (JSON Only)
{
  "ko": {
    "posting_title": "...",
    "executive_summary": ["...", "...", "..."]
  },
  "en": {
    "posting_title": "...",
    "executive_summary": ["...", "...", "..."]
  }
}
**CRITICAL**: Ensure all newlines within text are escaped as \\n. Output ONLY valid JSON.
"""

def get_combined_section_body_prompt(section_name: str) -> str:
    """
    í•œê¸€/ì˜ì–´ í†µí•© ì„¹ì…˜ ë³¸ë¬¸ ìƒì„±ìš© í”„ë¡¬í”„íŠ¸
    """
    return f"""
# Task
Analyze the provided news topics and write the "{section_name}" section in BOTH Korean and English.

# Writing Rules
1. 2-3 Sentence Rule: Sentence 1(Fact), Sentence 2(Context), Sentence 3(Impact).
2. Citations: List [Ref:ID] on new lines IMMEDIATELY after each topic's text. NO inline citations.
3. Content: 'ko' for local context, 'en' for global USD-based investor perspective.

# Output Format (JSON Only)
{{
  "ko": "### **[KR Title]**\\n[KR Text...]\\n[Ref:101]\\n[Ref:102]\\n\\n### **[Next KR Title]**...",
  "en": "### **[EN Title]**\\n[EN Text...]\\n[Ref:101]\\n[Ref:102]\\n\\n### **[Next EN Title]**..."
}}
**CRITICAL**: Strictly follow the JSON structure. Double-escape backslashes if necessary for valid JSON strings.
"""

```

---

## ## 2. `news_ingestor.py` ë©”ì¸ ë¡œì§ ê°œí¸ (ì‹¤í–‰ ê°€ì´ë“œ)

ì´ì œ ë¡œì§ì„ ìˆ˜ì •í•  ì°¨ë¡€ì…ë‹ˆë‹¤. ì»¤ì„œì—ê²Œ ì•„ë˜ì™€ ê°™ì´ ëª…ë ¹í•˜ì„¸ìš”.

> **Cursor ì§€ì‹œë¬¸:**
> "ì´ì œ `@news_ingestor.py`ë¥¼ ìˆ˜ì •í•´ì„œ í•œê¸€(`ko`)ê³¼ ì˜ì–´(`en`)ë¥¼ ê°ê° ìƒì„±í•˜ë˜ ë£¨í”„ë¥¼ í•˜ë‚˜ë¡œ í•©ì³ì¤˜.
>
> 1. `get_combined_...` í”„ë¡¬í”„íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ LLMì„ í˜¸ì¶œí•˜ë„ë¡ ë³€ê²½í•´.
> 2. `response_mime_type: "application/json"` ì˜µì…˜ì„ ì‚¬ìš©í•˜ì—¬ Gemini APIê°€ êµ¬ì¡°í™”ëœ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ê²Œ í•´.
> 3. í•œ ë²ˆì˜ API í˜¸ì¶œë¡œ ë°›ì€ JSONì—ì„œ `ko`ì™€ `en` ë°ì´í„°ë¥¼ ê°ê° ì¶”ì¶œí•´ ì €ì¥í•˜ëŠ” ë¡œì§ì„ êµ¬í˜„í•´.
> 4. ë¡œê·¸ ë©”ì‹œì§€ë¥¼ `âš¡ [Combined] Starting Parallel Generation...`ìœ¼ë¡œ í†µì¼í•˜ê³ , ì „ì²´ ì‹¤í–‰ ì‹œê°„ì„ ì¸¡ì •í•´ì¤˜."
>
>

---

## ## 3. ê²€ì¦ ë° ìµœì í™” ë¦¬í¬íŠ¸ (ì‚¬í›„ ì‘ì—…)

ìˆ˜ì •ì´ ì™„ë£Œë˜ë©´ ì»¤ì„œì—ê²Œ ì„±ëŠ¥ ë¹„êµë¥¼ ìš”ì²­í•˜ì„¸ìš”.

> **Cursor ì§€ì‹œë¬¸:**
> "ê°œí¸ëœ ì½”ë“œì˜ íš¨ìœ¨ì„±ì„ í™•ì¸í•˜ê³  ì‹¶ì–´.
>
> * ê¸°ì¡´ 2íšŒ í˜¸ì¶œ ëŒ€ë¹„ **ì…ë ¥ í† í°(Input Tokens)**ì´ ì–¼ë§ˆë‚˜ ì¤„ì–´ë“œëŠ”ì§€ ê³„ì‚°í•´ì¤˜. (ê¸°ì‚¬ ë°ì´í„° ì¤‘ë³µ ì „ì†¡ ì œê±° íš¨ê³¼)
> * ì „ì²´ **ìƒì„± ì†ë„(Latency)**ê°€ ê¸°ì¡´ ëŒ€ë¹„ ëª‡ í¼ì„¼íŠ¸ ê°œì„ ë˜ì—ˆëŠ”ì§€ ì¶”ì •í•´ì¤˜.
> * JSON íŒŒì‹± ì¤‘ ì—ëŸ¬ê°€ ë‚  ê²½ìš°ë¥¼ ëŒ€ë¹„í•œ **Exception Handling**ì´ ì œëŒ€ë¡œ ì ìš©ë˜ì—ˆëŠ”ì§€ ê²€í† í•´ì¤˜."
>
>

---

### ### ğŸ’¡ íŒ: ì•ˆì •ì ì¸ JSON íŒŒì‹±ì„ ìœ„í•œ íŒ

ì»¤ì„œê°€ ì½”ë“œë¥¼ ì§¤ ë•Œ `json.loads(response.text)`ë§Œ ì“°ì§€ ë§ê³ , ì•„ë˜ì™€ ê°™ì€ **Safety Wrapper**ë¥¼ ì“°ë„ë¡ ìœ ë„í•˜ë©´ ë” ì¢‹ìŠµë‹ˆë‹¤.

```python
import json
import re

def clean_and_load_json(text):
    # LLMì´ ê°„í˜¹ ```json ... ``` ì½”ë“œë¥¼ í¬í•¨í•  ê²½ìš° ì²˜ë¦¬
    clean_text = re.sub(r'```json|```', '', text).strip()
    return json.loads(clean_text)

```

**ì´ ê°€ì´ë“œëŒ€ë¡œ ì§„í–‰í•˜ì‹œë©´ ë¹„ìš©ì€ ì ˆë°˜ìœ¼ë¡œ ì¤„ì´ë©´ì„œ ê´€ë¦¬ëŠ” í›¨ì”¬ í¸í•´ì§ˆ ê±°ì˜ˆìš”. ë°”ë¡œ ì‹¤í–‰í•´ ë³´ì„¸ìš”!**

# Cursor_Refactoring #LLM_Optimization #SinglePass_AI #CostEfficiency
