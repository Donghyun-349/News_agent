
name: Weekly File Cleanup

on:
  schedule:
    # Runs at 15:00 UTC on Sunday (which is 00:00 KST on Monday)
    # This ensures "Weekly" cleanup at a leisurely time
    - cron: '0 15 * * 0'
  workflow_dispatch:
    # Allows manual trigger

jobs:
  cleanup:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        if [ -f requirements_v2.txt ]; then pip install -r requirements_v2.txt; fi

    - name: Run Cleanup Script
      run: |
        python run_cleanup.py

    - name: Commit and Push Changes
      run: |
        git config --global user.name 'GitHub Actions Bot'
        git config --global user.email 'actions@github.com'
        git add outputs/daily_reports/
        # Commit only if there are changes (files deleted)
        git commit -m "ðŸ§¹ Auto-cleanup old reports (>14 days)" || echo "No files to delete"
        git push
